---
title: "CID Diversity Plot"
output:
  github_document:
    df_print: tibble
editor_options: 
  chunk_output_type: console
---

```{r global_options, include=FALSE}
source(here::here("common.R"))
```

To generate Table 1: 

```{r,message=FALSE}
library(tidyverse)
library(yingtools2)
library(phyloseq)

```

First define age groups:
```{r}
pt <- cid.patients %>% 
  mutate(age.groups=cut2(agebmt,lower=c(30,40,50,60)),
         engraft.14d=engraftment & engraftment_day>=14)
pt %>% select(Patient_ID,agebmt,age.groups,engraftment,engraftment_day,engraft.14d)
```

Now I could generate the table using `make_table`.
```{r}
pt %>% make_table(age.groups,sex,primary.dx,priorabx.14d,intensity,
                  bmt.tcell.depletion,bmt.stemsource,engraft.14d,
                  fever,vanco_iv,fluoroquinolone,betalactam,
                  vre.bsi,gramneg.bsi,other.bsi,no.bsi,vital.status)
```
